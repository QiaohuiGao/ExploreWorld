{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";// #qiaohui: 添加 useRef\nimport axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TaskPage=_ref=>{let{title,content,onNext,onDataSubmit,videoUrl}=_ref;const[timer,setTimer]=useState(10);// 10-second timer\n// Countdown timer logic\nuseEffect(()=>{if(timer>0){const interval=setInterval(()=>{setTimer(prevTimer=>prevTimer-1);},1000);return()=>clearInterval(interval);// Clean up interval on component unmount\n}},[timer]);const[isPlaying,setIsPlaying]=useState(false);// #qiaohui: add video control button\nconst videoRef=useRef(null);// #qiaohui: add video control button\n// #qiaohui: add toggle video function\nconst toggleVideo=()=>{if(videoRef.current){if(isPlaying){videoRef.current.pause();}else{videoRef.current.play();}setIsPlaying(!isPlaying);}};// #qiaohui: Add this useEffect to handle video changes\nuseEffect(()=>{if(videoRef.current){videoRef.current.load();// #qiaohui: Reload the video when the URL changes\nsetIsPlaying(false);// #qiaohui: Reset the playing state\n}},[videoUrl]);const[inputData,setInputData]=useState(\"\");// Handle input changes\nconst handleInputChange=e=>{setInputData(e.target.value);// Update the state as user types\n};// Function to handle \"Next\" button click\nconst handleSubmit=()=>{if(onDataSubmit){onDataSubmit(inputData);// Pass the input data to parent via onDataSubmit\n}onNext();// Navigate to the next page\n};const imgRef=useRef(null);const[isRecording,setIsRecording]=useState(false);const[task,setTask]=useState('');const handleStartRecording=()=>{setIsRecording(true);setTask(title);};const handleStopRecording=async()=>{setIsRecording(false);try{const response=await axios.post(\"/api/stop_recording\",task,{headers:{\"Content-Type\":\"application/json\"}});console.log(response.data.message);}catch(error){console.error(\"Error stopping video feed:\",error);}};useEffect(()=>{if(imgRef.current){if(isRecording){imgRef.current.src=\"/api/start_recording\";}else{imgRef.current.src=\"https://placehold.co/600x400?text=Hello+World\";}}},[isRecording]);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex-row h-screen p-16\",children:[\" \",/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-center items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold\",children:title}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg\",children:content})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-grow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-center items-center w-1/2 p-4\",children:[\" \",/*#__PURE__*/_jsx(\"h5\",{className:\"text-2xl font-bold mb-6\",children:\"Demo Video\"}),/*#__PURE__*/_jsxs(\"video\",{ref:videoRef,width:\"320\",height:\"240\",controls:false,children:[/*#__PURE__*/_jsx(\"source\",{src:videoUrl,type:\"video/mp4\"}),\"Your browser does not support the video tag.\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn--accent text-lg mt-4\",onClick:toggleVideo,children:isPlaying?\"Pause Video\":\"Play Video\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-center items-center w-1/2 p-4\",children:[\" \",/*#__PURE__*/_jsxs(\"h1\",{className:\"text-2xl font-bold mb-6 text-center\",children:[\"Timer: \",timer,\"s\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-evenly items-center w-full h-full\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:\"Live Pose Detection\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-300 h-200 overflow-hidden border-2 border-solid border-gray-200\",children:isRecording?/*#__PURE__*/_jsx(\"img\",{ref:imgRef,alt:\"Video Feed\",className:\"object-cover w-full h-full\"}):/*#__PURE__*/_jsx(\"img\",{src:\"https://placehold.co/600x400?text=Video+Stream\",alt:\"Placeholder\",className:\"object-cover w-full h-full\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-row gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleStartRecording,className:\"btn btn-info btn-sm\",children:\"Start Recording\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleStopRecording,className:\"btn btn-success btn-sm\",children:\"Stop Recording\"})]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"How many have you done?\",className:\"input input-bordered input-primary w-full max-w-xs\",value:inputData,onChange:handleInputChange}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary text-lg mt-4\",onClick:handleSubmit,children:\"Next\"})]})]})]});};export default TaskPage;","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","jsx","_jsx","jsxs","_jsxs","TaskPage","_ref","title","content","onNext","onDataSubmit","videoUrl","timer","setTimer","interval","setInterval","prevTimer","clearInterval","isPlaying","setIsPlaying","videoRef","toggleVideo","current","pause","play","load","inputData","setInputData","handleInputChange","e","target","value","handleSubmit","imgRef","isRecording","setIsRecording","task","setTask","handleStartRecording","handleStopRecording","response","post","headers","console","log","data","message","error","src","className","children","ref","width","height","controls","type","onClick","alt","placeholder","onChange"],"sources":["/Users/qiaohui/SportifyMe/client/src/TaskPage.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\"; // #qiaohui: 添加 useRef\nimport axios from \"axios\";\n\nconst TaskPage = ({\n  title,\n  content,\n  onNext,\n  onDataSubmit,\n  videoUrl,\n}) => {\n  const [timer, setTimer] = useState(10); // 10-second timer\n\n  // Countdown timer logic\n  useEffect(() => {\n    if (timer > 0) {\n      const interval = setInterval(() => {\n        setTimer((prevTimer) => prevTimer - 1);\n      }, 1000);\n      return () => clearInterval(interval); // Clean up interval on component unmount\n    }\n  }, [timer]);\n\n  const [isPlaying, setIsPlaying] = useState(false); // #qiaohui: add video control button\n  const videoRef = useRef(null); // #qiaohui: add video control button\n\n  // #qiaohui: add toggle video function\n  const toggleVideo = () => {\n    if (videoRef.current) {\n      if (isPlaying) {\n        videoRef.current.pause();\n      } else {\n        videoRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    }\n  };\n\n  // #qiaohui: Add this useEffect to handle video changes\n  useEffect(() => {\n    if (videoRef.current) {\n      videoRef.current.load(); // #qiaohui: Reload the video when the URL changes\n      setIsPlaying(false); // #qiaohui: Reset the playing state\n    }\n  }, [videoUrl]);\n\n  const [inputData, setInputData] = useState(\"\");\n\n  // Handle input changes\n  const handleInputChange = (e) => {\n    setInputData(e.target.value); // Update the state as user types\n  };\n\n  // Function to handle \"Next\" button click\n  const handleSubmit = () => {\n    if (onDataSubmit) {\n      onDataSubmit(inputData); // Pass the input data to parent via onDataSubmit\n    }\n    onNext(); // Navigate to the next page\n  };\n\n  const imgRef = useRef(null);\n  const [isRecording, setIsRecording] = useState(false);\n  const [task, setTask] = useState('');\n\n  const handleStartRecording = () => {\n    setIsRecording(true);\n    setTask(title);\n  };\n\n  const handleStopRecording = async () => {\n    setIsRecording(false);\n    try {\n      const response = await axios.post(\"/api/stop_recording\", task, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      });\n      console.log(response.data.message);\n    } catch (error) {\n      console.error(\"Error stopping video feed:\", error);\n    }\n  };\n\n  useEffect(() => {\n    if (imgRef.current) {\n      if (isRecording) {\n        imgRef.current.src = \"/api/start_recording\";\n      } else {\n        imgRef.current.src = \"https://placehold.co/600x400?text=Hello+World\";\n      }\n    }\n  }, [isRecording]);\n  \n\n  return (\n    <div className=\"flex-row h-screen p-16\">\n      {\" \"}\n      {/* Changed to a flex container for two columns */}\n      <div className=\"flex flex-col justify-center items-center mb-6\">\n        <h3 className=\"text-2xl font-bold\">{title}</h3>\n        <h4 className=\"text-lg\">{content}</h4>\n      </div>\n      <div className=\"flex flex-grow\">\n        <div className=\"flex flex-col justify-center items-center w-1/2 p-4\">\n          {\" \"}\n          {/* Left column for video */}\n          <h5 className=\"text-2xl font-bold mb-6\">Demo Video</h5>\n          <video ref={videoRef} width=\"320\" height=\"240\" controls={false}>\n            <source src={videoUrl} type=\"video/mp4\" />\n            Your browser does not support the video tag.\n          </video>\n          <button\n            className=\"btn btn--accent text-lg mt-4\"\n            onClick={toggleVideo}\n          >\n            {isPlaying ? \"Pause Video\" : \"Play Video\"}\n          </button>\n        </div>\n\n        <div className=\"flex flex-col justify-center items-center w-1/2 p-4\">\n          {\" \"}\n          {/* Right column for other content */}\n          <h1 className=\"text-2xl font-bold mb-6 text-center\">\n            Timer: {timer}s\n          </h1>\n          <div\n            className=\"flex flex-col justify-evenly items-center w-full h-full\"\n          >\n            <h1 className=\"text-2xl font-bold\">Live Pose Detection</h1>\n            <div className=\"w-300 h-200 overflow-hidden border-2 border-solid border-gray-200\">\n              {isRecording ?(\n                <img ref={imgRef} alt=\"Video Feed\" className=\"object-cover w-full h-full\" />\n              ): (\n                <img src=\"https://placehold.co/600x400?text=Video+Stream\" alt=\"Placeholder\" className=\"object-cover w-full h-full\" />\n              )}\n            </div>\n            <div className=\"flex flex-row gap-4\">\n              <button\n                onClick={handleStartRecording}\n                className=\"btn btn-info btn-sm\"\n              >\n                Start Recording\n              </button>\n              <button\n                onClick={handleStopRecording}\n                className=\"btn btn-success btn-sm\"\n              >\n                Stop Recording\n              </button>\n            </div>\n          </div>\n          <input\n            type=\"text\"\n            placeholder=\"How many have you done?\"\n            className=\"input input-bordered input-primary w-full max-w-xs\"\n            value={inputData}\n            onChange={handleInputChange}\n          />\n          <button\n            className=\"btn btn-primary text-lg mt-4\"\n            onClick={handleSubmit}\n          >\n            Next\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TaskPage;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAAE;AAC5D,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE1B,KAAM,CAAAC,QAAQ,CAAGC,IAAA,EAMX,IANY,CAChBC,KAAK,CACLC,OAAO,CACPC,MAAM,CACNC,YAAY,CACZC,QACF,CAAC,CAAAL,IAAA,CACC,KAAM,CAACM,KAAK,CAAEC,QAAQ,CAAC,CAAGhB,QAAQ,CAAC,EAAE,CAAC,CAAE;AAExC;AACAC,SAAS,CAAC,IAAM,CACd,GAAIc,KAAK,CAAG,CAAC,CAAE,CACb,KAAM,CAAAE,QAAQ,CAAGC,WAAW,CAAC,IAAM,CACjCF,QAAQ,CAAEG,SAAS,EAAKA,SAAS,CAAG,CAAC,CAAC,CACxC,CAAC,CAAE,IAAI,CAAC,CACR,MAAO,IAAMC,aAAa,CAACH,QAAQ,CAAC,CAAE;AACxC,CACF,CAAC,CAAE,CAACF,KAAK,CAAC,CAAC,CAEX,KAAM,CAACM,SAAS,CAAEC,YAAY,CAAC,CAAGtB,QAAQ,CAAC,KAAK,CAAC,CAAE;AACnD,KAAM,CAAAuB,QAAQ,CAAGrB,MAAM,CAAC,IAAI,CAAC,CAAE;AAE/B;AACA,KAAM,CAAAsB,WAAW,CAAGA,CAAA,GAAM,CACxB,GAAID,QAAQ,CAACE,OAAO,CAAE,CACpB,GAAIJ,SAAS,CAAE,CACbE,QAAQ,CAACE,OAAO,CAACC,KAAK,CAAC,CAAC,CAC1B,CAAC,IAAM,CACLH,QAAQ,CAACE,OAAO,CAACE,IAAI,CAAC,CAAC,CACzB,CACAL,YAAY,CAAC,CAACD,SAAS,CAAC,CAC1B,CACF,CAAC,CAED;AACApB,SAAS,CAAC,IAAM,CACd,GAAIsB,QAAQ,CAACE,OAAO,CAAE,CACpBF,QAAQ,CAACE,OAAO,CAACG,IAAI,CAAC,CAAC,CAAE;AACzBN,YAAY,CAAC,KAAK,CAAC,CAAE;AACvB,CACF,CAAC,CAAE,CAACR,QAAQ,CAAC,CAAC,CAEd,KAAM,CAACe,SAAS,CAAEC,YAAY,CAAC,CAAG9B,QAAQ,CAAC,EAAE,CAAC,CAE9C;AACA,KAAM,CAAA+B,iBAAiB,CAAIC,CAAC,EAAK,CAC/BF,YAAY,CAACE,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAE;AAChC,CAAC,CAED;AACA,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAM,CACzB,GAAItB,YAAY,CAAE,CAChBA,YAAY,CAACgB,SAAS,CAAC,CAAE;AAC3B,CACAjB,MAAM,CAAC,CAAC,CAAE;AACZ,CAAC,CAED,KAAM,CAAAwB,MAAM,CAAGlC,MAAM,CAAC,IAAI,CAAC,CAC3B,KAAM,CAACmC,WAAW,CAAEC,cAAc,CAAC,CAAGtC,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACuC,IAAI,CAAEC,OAAO,CAAC,CAAGxC,QAAQ,CAAC,EAAE,CAAC,CAEpC,KAAM,CAAAyC,oBAAoB,CAAGA,CAAA,GAAM,CACjCH,cAAc,CAAC,IAAI,CAAC,CACpBE,OAAO,CAAC9B,KAAK,CAAC,CAChB,CAAC,CAED,KAAM,CAAAgC,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtCJ,cAAc,CAAC,KAAK,CAAC,CACrB,GAAI,CACF,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAxC,KAAK,CAACyC,IAAI,CAAC,qBAAqB,CAAEL,IAAI,CAAE,CAC7DM,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CACF,CAAC,CAAC,CACFC,OAAO,CAACC,GAAG,CAACJ,QAAQ,CAACK,IAAI,CAACC,OAAO,CAAC,CACpC,CAAE,MAAOC,KAAK,CAAE,CACdJ,OAAO,CAACI,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CACpD,CACF,CAAC,CAEDjD,SAAS,CAAC,IAAM,CACd,GAAImC,MAAM,CAACX,OAAO,CAAE,CAClB,GAAIY,WAAW,CAAE,CACfD,MAAM,CAACX,OAAO,CAAC0B,GAAG,CAAG,sBAAsB,CAC7C,CAAC,IAAM,CACLf,MAAM,CAACX,OAAO,CAAC0B,GAAG,CAAG,+CAA+C,CACtE,CACF,CACF,CAAC,CAAE,CAACd,WAAW,CAAC,CAAC,CAGjB,mBACE9B,KAAA,QAAK6C,SAAS,CAAC,wBAAwB,CAAAC,QAAA,EACpC,GAAG,cAEJ9C,KAAA,QAAK6C,SAAS,CAAC,gDAAgD,CAAAC,QAAA,eAC7DhD,IAAA,OAAI+C,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAE3C,KAAK,CAAK,CAAC,cAC/CL,IAAA,OAAI+C,SAAS,CAAC,SAAS,CAAAC,QAAA,CAAE1C,OAAO,CAAK,CAAC,EACnC,CAAC,cACNJ,KAAA,QAAK6C,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9C,KAAA,QAAK6C,SAAS,CAAC,qDAAqD,CAAAC,QAAA,EACjE,GAAG,cAEJhD,IAAA,OAAI+C,SAAS,CAAC,yBAAyB,CAAAC,QAAA,CAAC,YAAU,CAAI,CAAC,cACvD9C,KAAA,UAAO+C,GAAG,CAAE/B,QAAS,CAACgC,KAAK,CAAC,KAAK,CAACC,MAAM,CAAC,KAAK,CAACC,QAAQ,CAAE,KAAM,CAAAJ,QAAA,eAC7DhD,IAAA,WAAQ8C,GAAG,CAAErC,QAAS,CAAC4C,IAAI,CAAC,WAAW,CAAE,CAAC,+CAE5C,EAAO,CAAC,cACRrD,IAAA,WACE+C,SAAS,CAAC,8BAA8B,CACxCO,OAAO,CAAEnC,WAAY,CAAA6B,QAAA,CAEpBhC,SAAS,CAAG,aAAa,CAAG,YAAY,CACnC,CAAC,EACN,CAAC,cAENd,KAAA,QAAK6C,SAAS,CAAC,qDAAqD,CAAAC,QAAA,EACjE,GAAG,cAEJ9C,KAAA,OAAI6C,SAAS,CAAC,qCAAqC,CAAAC,QAAA,EAAC,SAC3C,CAACtC,KAAK,CAAC,GAChB,EAAI,CAAC,cACLR,KAAA,QACE6C,SAAS,CAAC,yDAAyD,CAAAC,QAAA,eAEnEhD,IAAA,OAAI+C,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,qBAAmB,CAAI,CAAC,cAC3DhD,IAAA,QAAK+C,SAAS,CAAC,mEAAmE,CAAAC,QAAA,CAC/EhB,WAAW,cACVhC,IAAA,QAAKiD,GAAG,CAAElB,MAAO,CAACwB,GAAG,CAAC,YAAY,CAACR,SAAS,CAAC,4BAA4B,CAAE,CAAC,cAE5E/C,IAAA,QAAK8C,GAAG,CAAC,gDAAgD,CAACS,GAAG,CAAC,aAAa,CAACR,SAAS,CAAC,4BAA4B,CAAE,CACrH,CACE,CAAC,cACN7C,KAAA,QAAK6C,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAClChD,IAAA,WACEsD,OAAO,CAAElB,oBAAqB,CAC9BW,SAAS,CAAC,qBAAqB,CAAAC,QAAA,CAChC,iBAED,CAAQ,CAAC,cACThD,IAAA,WACEsD,OAAO,CAAEjB,mBAAoB,CAC7BU,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CACnC,gBAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,cACNhD,IAAA,UACEqD,IAAI,CAAC,MAAM,CACXG,WAAW,CAAC,yBAAyB,CACrCT,SAAS,CAAC,oDAAoD,CAC9DlB,KAAK,CAAEL,SAAU,CACjBiC,QAAQ,CAAE/B,iBAAkB,CAC7B,CAAC,cACF1B,IAAA,WACE+C,SAAS,CAAC,8BAA8B,CACxCO,OAAO,CAAExB,YAAa,CAAAkB,QAAA,CACvB,MAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAA7C,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}